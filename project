#!/bin/bash

# brat project - create a new R project with standard structure

BRAT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Parse arguments
open_after=false
title=""

for arg in "$@"; do
  case "$arg" in
    -o|--open)
      open_after=true
      ;;
    *)
      if [[ -z "$title" ]]; then
        title="$arg"
      fi
      ;;
  esac
done

# Default project name if none provided
title="${title:-new_project}"

mkdir -p "$title"/{data-raw,data,ref,output}

cd "$title"

touch script.R

cat > "$title.Rproj" << 'EOF'
Version: 1.0

RestoreWorkspace: Default
SaveWorkspace: Default
AlwaysSaveHistory: Default

EnableCodeIndexing: Yes
UseSpacesForTab: Yes
NumSpacesForTab: 2
Encoding: UTF-8

RnwWeave: Sweave
LaTex: pdfLaTeX
EOF

echo "Project $title has been created."

if [[ "$open_after" == true ]]; then
  exec "$BRAT_DIR/rstudio" "$title.Rproj"
fi
