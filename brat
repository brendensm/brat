#!/usr/bin/env bash

# brat - bash-based r-adjacent tools

BRAT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

show_help() {
  echo "brat - bash-based r-adjacent tools"
  echo ""
  echo "Usage: brat <command> [arguments]"
  echo ""
  echo "Commands:"
  echo "  project <name>   Create a new R project with standard structure"
  echo "                   Use -o or --open to open in RStudio after creation"
  echo "  rstudio [path]   Open RStudio (alias: rs)"
  echo "                   Auto-detects .Rproj files in directories"
  echo "  clean [path]     Remove R artifacts (.Rhistory, .RData, caches, etc.)"
  echo "                   Use -n for dry-run, -r for recursive"
  echo "  install <pkg>    Install from CRAN (or GitHub with user/repo)"
  echo "                   Use -s to search CRAN interactively"
  echo "  update           Check for and install package updates"
  echo "  tt               Browse and explore TidyTuesday datasets"
  echo "  blog <title>     Create a Quarto blog post template"
  echo "  logo             Print the brat logo"
  echo "  help             Show this help message"
  echo ""
  echo "Examples:"
  echo "  brat project myanalysis"
  echo "  brat project myanalysis -o"
  echo "  brat rstudio ."
  echo "  brat rs ~/R/myproject"
  echo "  brat clean"
  echo "  brat clean -rn ~/R"
  echo "  brat install dplyr"
  echo "  brat install -s tidy"
  echo "  brat install user/repo"
  echo "  brat update"
  echo "  brat tt"
  echo "  brat blog \"My First Post\""
}

if [[ $# -eq 0 || "$1" == "help" || "$1" == "--help" || "$1" == "-h" ]]; then
  show_help
  exit 0
fi

command="$1"
shift

case "$command" in
  project)
    exec "$BRAT_DIR/project" "$@"
    ;;
  rstudio|rs)
    exec "$BRAT_DIR/rstudio" "$@"
    ;;
  clean)
    exec "$BRAT_DIR/clean" "$@"
    ;;
  install)
    exec "$BRAT_DIR/install" "$@"
    ;;
  update)
    exec "$BRAT_DIR/update" "$@"
    ;;
  tt)
    exec "$BRAT_DIR/tt" "$@"
    ;;
  blog)
    exec "$BRAT_DIR/blog" "$@"
    ;;
  logo)
    exec "$BRAT_DIR/logo" "$@"
    ;;
  *)
    echo "Unknown command: $command"
    echo "Run 'brat help' for usage."
    exit 1
    ;;
esac
